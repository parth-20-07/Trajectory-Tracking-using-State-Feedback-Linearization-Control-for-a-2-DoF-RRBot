<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2023a"><title>Programming Assignment 3</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S2 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Programming Assignment 3</span></h1><h2  class = 'S1'><span>Clear Environment</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >clc;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >clear </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >close </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >warning (</span><span style="color: rgb(167, 9, 245);">'off'</span><span >, </span><span style="color: rgb(167, 9, 245);">'all'</span><span >); </span><span style="color: rgb(0, 128, 19);">% Stopping all warnings</span></span></div></div></div><h2  class = 'S5'><span>Loading Model Parameters</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >mass_1 = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >mass_2 = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >arm_1_length = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >arm_2_length = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >center_of_mass_distance_1 = 0.45;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >center_of_mass_distance_2 = 0.45;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >moment_of_inertia_1 = 0.084;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >moment_of_inertia_2 = 0.084;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >gravitational_acceleration = 9.81;</span></span></div></div></div><h2  class = 'S5'><span>Part A: Trajectory Generation</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >syms </span><span style="color: rgb(167, 9, 245);">a0 a1 a2 a3 t</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_configuration = a0 + a1 * t + a2 * t^2 + a3 * t^3</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_dot_configuration = diff(theta_configuration, t)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >timespan = [0 10];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_1_configuration = [deg2rad(180) deg2rad(0)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_2_configuration = [deg2rad(90) deg2rad(0)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_dot_1_configuration = [deg2rad(0) deg2rad(0)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_dot_2_configuration = [deg2rad(0) deg2rad(0)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Calculating theta1 Trajectory</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq1 = subs(theta_configuration, t, timespan(1, 1)) == theta_1_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq2 = subs(theta_configuration, t, timespan(1, 2)) == theta_1_configuration(1, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq3 = subs(theta_dot_configuration, t, timespan(1, 1)) == theta_dot_1_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq4 = subs(theta_dot_configuration, t, timespan(1, 2)) == theta_dot_1_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >[q10, q11, q12, q13] = solve([eq1, eq2, eq3, eq4], [a0, a1, a2, a3]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta1_trajectory = q10 + q11 * t + q12 * t^2 + q13 * t^3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta1_dot_trajectory = diff(theta1_trajectory, t);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta1_ddot_trajectory = diff(theta1_trajectory, t, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x1d_trajectory = formula([theta1_trajectory; theta1_dot_trajectory])</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v1d_trajectory = theta1_ddot_trajectory</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Calculating theta2 Trajectory</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq1 = subs(theta_configuration, t, timespan(1, 1)) == theta_2_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq2 = subs(theta_configuration, t, timespan(1, 2)) == theta_2_configuration(1, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq3 = subs(theta_dot_configuration, t, timespan(1, 1)) == theta_dot_2_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >eq4 = subs(theta_dot_configuration, t, timespan(1, 2)) == theta_dot_2_configuration(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >[q20, q21, q22, q23] = solve([eq1, eq2, eq3, eq4], [a0, a1, a2, a3]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta2_trajectory = q20 + q21 * t + q22 * t^2 + q23 * t^3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta2_dot_trajectory = diff(theta2_trajectory, t);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta2_ddot_trajectory = diff(theta2_trajectory, t, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x2d_trajectory = formula([theta2_trajectory; theta2_dot_trajectory])</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v2d_trajectory = theta2_ddot_trajectory</span></span></div></div></div><h2  class = 'S5'><span>Part B: Manipulator Form Derivation from Programming Assignment 1</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >prog_assignment1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ddq = simplify(ddq);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >syms </span><span style="color: rgb(167, 9, 245);">ddq1 ddq2 dq1 dq2 q1 q2</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ddq_mf = subs(ddq, [m1, m2, r1, r2, I1, I2, l1, l2, g], [mass_1, mass_2, center_of_mass_distance_1, center_of_mass_distance_2, moment_of_inertia_1, moment_of_inertia_2, arm_1_length, arm_2_length, gravitational_acceleration]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ddq_mf = subs(ddq_mf, [diff(theta1, t, 2), diff(theta2, t, 2)], [ddq1, ddq2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ddq_mf = subs(ddq_mf, [diff(theta1, t), diff(theta2, t)], [dq1, dq2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ddq_mf = subs(ddq_mf, [theta1, theta2], [q1, q2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >[tau1, tau2] = solve(ddq_mf, [T1,T2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >tau = formula(simplify([tau1;tau2]))</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >clear </span><span style="color: rgb(167, 9, 245);">m1 m2 r1 r2 I1 I2 l1 l2 g</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%Gravity Matrix</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >gravity_matrix = formula(simplify(subs(tau, [ddq1, dq1, ddq2, dq2], [0, 0, 0, 0])))</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%Mass Matrix</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >mass_matrix = formula(simplify(subs(tau, [dq1, dq2], [0, 0]) - gravity_matrix));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >mass_matrix = collect(mass_matrix,[ddq1,ddq2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >mass_matrix = formula([subs(mass_matrix(1,:),[ddq1,ddq2],[1,0]),subs(mass_matrix(1,:),[ddq1,ddq2],[0,1]);subs(mass_matrix(2,:),[ddq1,ddq2],[1,0]),subs(mass_matrix(2,:),[ddq1,ddq2],[0,1])])</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%Coriolis Matrix</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >coriolis_matrix = formula(simplify(tau - gravity_matrix - mass_matrix*[ddq1;ddq2]))</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >system_input = formula(mass_matrix*[ddq1;ddq2] + coriolis_matrix + gravity_matrix);</span></span></div></div></div><h2  class = 'S5'><span>Part C: Feedback Linearlization</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%For diff(theta1,t,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%v1 = ddq1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x11 = q1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x12 = dq1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x1 = [x11; x12];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%dx1 = [x12; v1];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >A1 = [0 1; 0 0];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >B1 = [0; 1];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%A_sys = A - BK</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >lambda1 = [-3, -4]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >K1 = place(A1, B1, lambda1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v1 = (-K1 * (x1 - x1d_trajectory)) + v1d_trajectory;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% For diff(theta2,t,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%v2 = ddq2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x21 = q2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x22 = dq2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x2 = [x21; x22];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%dx2 = [x22; v2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >A2 = [0 1; 0 0];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >B2 = [0; 1];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%A_sys = A - BK</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >lambda2 = [-5, -6]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >K2 = place(A2, B2, lambda2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v2 = (-K2 * (x2 - x2d_trajectory)) + v2d_trajectory;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Virtual Control Input</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v = formula([v1; v2])</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% State FeedBack Control Strategy</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >system_input = subs(system_input, [ddq1, ddq2], [v(1), v(2)])</span></span></div></div></div><h2  class = 'S5'><span>Part D: Update ODE Function from Programming Assignment 2</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >syms </span><span style="color: rgb(167, 9, 245);">x1(t) x2(t) x3(t) x4(t)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%x = [x1;x2;x3;x4] = [theta1; dtheta1; theta2; dtheta2]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%dx = [dx1;dx2;dx3;dx4] = [dtheta1; ddtheta1; dtheta2; ddtheta2]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%dx = [x2;ddq1;x3;ddq2]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%dx = subs(ddq_mf,[T1,T2],[system_input(1),system_input(2)]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%[mddq1,mddq2] = solve(dx,[ddq1,ddq2]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%v_func = [x2; mddq1; x4; mddq2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v_func = [x2; v(1); x4; v(2)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >v_func = subs(v_func, [q1, dq1, q2, dq2], [x1, x2, x3, x4]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >vars = [x1(t) x2(t) x3(t) x4(t)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Modified prog_assignment2.m</span></span></div></div></div><h2  class = 'S5'><span>Part E: Simulate the system using ODE45</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >initial_params = [deg2rad(200); deg2rad(0); deg2rad(125); deg2rad(0)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%clear time state_space_matrix system_plot_points theta_plot_points;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >prog_assignment2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >t_size = size(time);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >t_size = t_size(1, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >theta_plot_points = zeros(t_size, 4);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >system_input_points = zeros(t_size, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >i = 1:t_size</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    theta_plot_points(i, 1) = (simplify(subs(x1d_trajectory(1), t, time(i, 1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    theta_plot_points(i, 2) = (simplify(subs(x1d_trajectory(2), t, time(i, 1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    theta_plot_points(i, 3) = (simplify(subs(x2d_trajectory(1), t, time(i, 1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    theta_plot_points(i, 4) = (simplify(subs(x2d_trajectory(2), t, time(i, 1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    system_input_points(i, 1) = double(simplify(subs(system_input(1), [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    system_input_points(i, 2) = double(simplify(subs(system_input(2), [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    virtual_input(i,1) = double(simplify(subs(v1, [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    virtual_input(i,2) = double(simplify(subs(v2, [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >tau1_max = max(system_input_points(:, 1))</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >tau1_min = min(system_input_points(:, 1))</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >tau2_max = max(system_input_points(:, 2))</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >tau2_min = min(system_input_points(:, 2))</span></span></div></div></div><h2  class = 'S5'><span>Calculating Link Positions</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >actual_position = zeros(t_size(1, 1), 4);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >trajectory_position = zeros(t_size(1, 1), 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >i = 1:t_size(1, 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actual_position(i, 1) = arm_1_length * sin(state_space_matrix(i, 1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actual_position(i, 2) = arm_1_length * cos(state_space_matrix(i, 1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actual_position(i, 3) = actual_position(i, 1) + arm_2_length * sin(state_space_matrix(i, 1) + state_space_matrix(i, 3));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actual_position(i, 4) = actual_position(i, 2) + arm_2_length * cos(state_space_matrix(i, 1) + state_space_matrix(i, 3));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectory_position(i, 1) = arm_1_length * sin(theta_plot_points(i, 1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectory_position(i, 2) = arm_1_length * cos(theta_plot_points(i, 1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectory_position(i, 3) = trajectory_position(i, 1) + arm_2_length * sin(theta_plot_points(i, 1) + theta_plot_points(i, 3));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectory_position(i, 4) = trajectory_position(i, 2) + arm_2_length * cos(theta_plot_points(i, 1) + theta_plot_points(i, 3));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div></div><h2  class = 'S5'><span>Animation</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >xAxisArrayXCoordinates = [-2 2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xAxisArrayYCoordinates = [0 0];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >yAxisArrayXCoordinates = [0 0];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >yAxisArrayYCoordinates = [-2 2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >th = 0:pi / 50:2 * pi;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xunit = ((arm_1_length + arm_2_length) * cos(th));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >yunit = ((arm_1_length + arm_2_length) * sin(th));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >animation = VideoWriter(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation.avi'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >open(animation);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >i = 1:1:t_size(1, 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">%Plotting Graph</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actuallink1XCoordinates = [0 actual_position(i, 1)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actuallink1YCoordinates = [0 actual_position(i, 2)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actuallink2XCoordinates = [actual_position(i, 1) actual_position(i, 3)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    actuallink2YCoordinates = [actual_position(i, 2) actual_position(i, 4)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectorylink1XCoordinates = [0 trajectory_position(i, 1)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectorylink1YCoordinates = [0 trajectory_position(i, 2)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectorylink2XCoordinates = [trajectory_position(i, 1) trajectory_position(i, 3)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    trajectorylink2YCoordinates = [trajectory_position(i, 2) trajectory_position(i, 4)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    plot(xunit, yunit, </span><span style="color: rgb(167, 9, 245);">'k'</span><span >, </span><span style="color: rgb(167, 9, 245);">'LineStyle'</span><span >, </span><span style="color: rgb(167, 9, 245);">'--'</span><span >); </span><span style="color: rgb(0, 128, 19);">% Draw Circular Axes</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    plot(actuallink1XCoordinates, actuallink1YCoordinates, </span><span style="color: rgb(167, 9, 245);">'red'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    plot(actuallink2XCoordinates, actuallink2YCoordinates, </span><span style="color: rgb(167, 9, 245);">'blue'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    plot(trajectorylink1XCoordinates, trajectorylink1YCoordinates, </span><span style="color: rgb(167, 9, 245);">'black'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    plot(trajectorylink2XCoordinates, trajectorylink2YCoordinates, </span><span style="color: rgb(167, 9, 245);">'black'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    frame = getframe(gcf);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    writeVideo(animation,frame);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    pause(0.1); </span><span style="color: rgb(0, 128, 19);">% pause to see realtime animation. Given in seconds</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >close(animation);</span></span></div></div></div><h2  class = 'S5'><span>Part E (a): Plot Trajectories</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >plot(time, theta_plot_points(:, 1), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, state_space_matrix(:, 1), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Actual Path'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\theta_{1}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_theta1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, theta_plot_points(:, 2), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, state_space_matrix(:, 2), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Actual Path'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'$\dot{\theta}_{1}$'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Interpreter'</span><span >, </span><span style="color: rgb(167, 9, 245);">'latex'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_dtheta1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, system_input_points(:, 1), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, virtual_input(:, 1), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Torque'</span><span >,</span><span style="color: rgb(167, 9, 245);">'Virtual Input'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\tau_{1}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_tau1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, theta_plot_points(:, 3), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, state_space_matrix(:, 3), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Actual Path'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\theta_{2}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_theta2.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, theta_plot_points(:, 4), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, state_space_matrix(:, 4), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Actual Path'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'$\dot{\theta}_{2}$'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Interpreter'</span><span >, </span><span style="color: rgb(167, 9, 245);">'latex'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_dtheta2.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, system_input_points(:, 2), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(time, virtual_input(:, 2), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Torque'</span><span >,</span><span style="color: rgb(167, 9, 245);">'Virtual Input'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\tau_{2}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title(</span><span style="color: rgb(167, 9, 245);">'MATLAB Simulation'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'matlab_tau2.jpg'</span><span >)</span></span></div></div></div><h2  class = 'S5'><span>Saving Data</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >delete </span><span style="color: rgb(167, 9, 245);">'matlab_efforts.xls'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >delete </span><span style="color: rgb(167, 9, 245);">'matlab_theta_plot_points.xls'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >delete </span><span style="color: rgb(167, 9, 245);">'matlab_virtual_input.xls'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >delete </span><span style="color: rgb(167, 9, 245);">'matlab_time.xls'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >delete </span><span style="color: rgb(167, 9, 245);">'trajectory.xls'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writematrix(system_input_points,</span><span style="color: rgb(167, 9, 245);">'matlab_efforts.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writematrix(state_space_matrix,</span><span style="color: rgb(167, 9, 245);">'matlab_theta_plot_points.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writematrix(virtual_input,</span><span style="color: rgb(167, 9, 245);">'matlab_virtual_input.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writematrix(time,</span><span style="color: rgb(167, 9, 245);">'matlab_time.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >writematrix(theta_plot_points,</span><span style="color: rgb(167, 9, 245);">'trajectory.xls'</span><span >);</span></span></div></div></div><h2  class = 'S5'><span>Part F: Gazebo Simulation</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >clc;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >clear </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >close </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >rrbot_traj_control</span><span style="color: rgb(0, 128, 19);">% Run the file for next part</span></span></div></div></div><h2  class = 'S5'><span>Comparing Results</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >clc;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >clear </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >close </span><span style="color: rgb(167, 9, 245);">all</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >matlab_efforts = readmatrix(</span><span style="color: rgb(167, 9, 245);">'matlab_efforts.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >matlab_joint_states = readmatrix(</span><span style="color: rgb(167, 9, 245);">'matlab_theta_plot_points.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >matlab_virtual_input = readmatrix(</span><span style="color: rgb(167, 9, 245);">'matlab_virtual_input.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >matlab_time = readmatrix(</span><span style="color: rgb(167, 9, 245);">'matlab_time.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >trajectory = readmatrix(</span><span style="color: rgb(167, 9, 245);">'trajectory.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >gazebo_efforts = readmatrix(</span><span style="color: rgb(167, 9, 245);">'gazebo_efforts.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >gazebo_joint_states = readmatrix(</span><span style="color: rgb(167, 9, 245);">'gazebo_theta_plot_points.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >gazebo_virtual_input = readmatrix(</span><span style="color: rgb(167, 9, 245);">'gazebo_virtual_input.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >gazebo_time = readmatrix(</span><span style="color: rgb(167, 9, 245);">'gazebo_time.xls'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, trajectory(:, 1), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_joint_states(:, 1), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_joint_states(:, 1), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >,</span><span style="color: rgb(167, 9, 245);">'Matlab'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\theta_{1}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_theta1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, trajectory(:, 2), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_joint_states(:, 2), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_joint_states(:, 2), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Matlab'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'$\dot{\theta}_{1}$'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Interpreter'</span><span >, </span><span style="color: rgb(167, 9, 245);">'latex'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_dtheta1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_efforts(:, 1), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_virtual_input(:, 1), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_efforts(:, 1), </span><span style="color: rgb(167, 9, 245);">'blue'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_virtual_input(:, 1), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'MATLAB Torque'</span><span >, </span><span style="color: rgb(167, 9, 245);">'MATLAB Virtual Input'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo Torque'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo Virtual Input'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\tau_{1}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_tau1.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, trajectory(:, 3), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_joint_states(:, 3), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_joint_states(:, 3), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Matlab'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\theta_{2}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_theta2.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, trajectory(:, 4), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_joint_states(:, 4), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_joint_states(:, 4), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'Trajectory'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Matlab'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'$\dot{\theta}_{2}$'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Interpreter'</span><span >, </span><span style="color: rgb(167, 9, 245);">'latex'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_dtheta2.jpg'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_efforts(:, 1), </span><span style="color: rgb(167, 9, 245);">'red'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(matlab_time, matlab_virtual_input(:, 1), </span><span style="color: rgb(167, 9, 245);">'green'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_efforts(:, 1), </span><span style="color: rgb(167, 9, 245);">'blue'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >plot(gazebo_time, gazebo_virtual_input(:, 1), </span><span style="color: rgb(167, 9, 245);">'black'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'MATLAB Torque'</span><span >, </span><span style="color: rgb(167, 9, 245);">'MATLAB Virtual Input'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo Torque'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Gazebo Virtual Input'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >grid </span><span style="color: rgb(167, 9, 245);">on</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'time'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'\tau_{1}'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >saveas(gcf, </span><span style="color: rgb(167, 9, 245);">'comparision_tau1.jpg'</span><span >)</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Programming Assignment 3
%% Clear Environment

clc;
clear all;
close all;
warning ('off', 'all'); % Stopping all warnings
%% Loading Model Parameters

mass_1 = 1;
mass_2 = 1;
arm_1_length = 1;
arm_2_length = 1;
center_of_mass_distance_1 = 0.45;
center_of_mass_distance_2 = 0.45;
moment_of_inertia_1 = 0.084;
moment_of_inertia_2 = 0.084;
gravitational_acceleration = 9.81;
%% Part A: Trajectory Generation

syms a0 a1 a2 a3 t
theta_configuration = a0 + a1 * t + a2 * t^2 + a3 * t^3
theta_dot_configuration = diff(theta_configuration, t)
timespan = [0 10];
theta_1_configuration = [deg2rad(180) deg2rad(0)];
theta_2_configuration = [deg2rad(90) deg2rad(0)];
theta_dot_1_configuration = [deg2rad(0) deg2rad(0)];
theta_dot_2_configuration = [deg2rad(0) deg2rad(0)];

% Calculating theta1 Trajectory
eq1 = subs(theta_configuration, t, timespan(1, 1)) == theta_1_configuration(1, 1);
eq2 = subs(theta_configuration, t, timespan(1, 2)) == theta_1_configuration(1, 2);
eq3 = subs(theta_dot_configuration, t, timespan(1, 1)) == theta_dot_1_configuration(1, 1);
eq4 = subs(theta_dot_configuration, t, timespan(1, 2)) == theta_dot_1_configuration(1, 1);
[q10, q11, q12, q13] = solve([eq1, eq2, eq3, eq4], [a0, a1, a2, a3]);
theta1_trajectory = q10 + q11 * t + q12 * t^2 + q13 * t^3;
theta1_dot_trajectory = diff(theta1_trajectory, t);
theta1_ddot_trajectory = diff(theta1_trajectory, t, 2);
x1d_trajectory = formula([theta1_trajectory; theta1_dot_trajectory])
v1d_trajectory = theta1_ddot_trajectory

% Calculating theta2 Trajectory
eq1 = subs(theta_configuration, t, timespan(1, 1)) == theta_2_configuration(1, 1);
eq2 = subs(theta_configuration, t, timespan(1, 2)) == theta_2_configuration(1, 2);
eq3 = subs(theta_dot_configuration, t, timespan(1, 1)) == theta_dot_2_configuration(1, 1);
eq4 = subs(theta_dot_configuration, t, timespan(1, 2)) == theta_dot_2_configuration(1, 1);
[q20, q21, q22, q23] = solve([eq1, eq2, eq3, eq4], [a0, a1, a2, a3]);
theta2_trajectory = q20 + q21 * t + q22 * t^2 + q23 * t^3;
theta2_dot_trajectory = diff(theta2_trajectory, t);
theta2_ddot_trajectory = diff(theta2_trajectory, t, 2);
x2d_trajectory = formula([theta2_trajectory; theta2_dot_trajectory])
v2d_trajectory = theta2_ddot_trajectory
%% Part B: Manipulator Form Derivation from Programming Assignment 1

prog_assignment1;
ddq = simplify(ddq);
syms ddq1 ddq2 dq1 dq2 q1 q2
ddq_mf = subs(ddq, [m1, m2, r1, r2, I1, I2, l1, l2, g], [mass_1, mass_2, center_of_mass_distance_1, center_of_mass_distance_2, moment_of_inertia_1, moment_of_inertia_2, arm_1_length, arm_2_length, gravitational_acceleration]);
ddq_mf = subs(ddq_mf, [diff(theta1, t, 2), diff(theta2, t, 2)], [ddq1, ddq2]);
ddq_mf = subs(ddq_mf, [diff(theta1, t), diff(theta2, t)], [dq1, dq2]);
ddq_mf = subs(ddq_mf, [theta1, theta2], [q1, q2]);
[tau1, tau2] = solve(ddq_mf, [T1,T2]);
tau = formula(simplify([tau1;tau2]))
clear m1 m2 r1 r2 I1 I2 l1 l2 g;

%Gravity Matrix
gravity_matrix = formula(simplify(subs(tau, [ddq1, dq1, ddq2, dq2], [0, 0, 0, 0])))
%Mass Matrix
mass_matrix = formula(simplify(subs(tau, [dq1, dq2], [0, 0]) - gravity_matrix));
mass_matrix = collect(mass_matrix,[ddq1,ddq2]);
mass_matrix = formula([subs(mass_matrix(1,:),[ddq1,ddq2],[1,0]),subs(mass_matrix(1,:),[ddq1,ddq2],[0,1]);subs(mass_matrix(2,:),[ddq1,ddq2],[1,0]),subs(mass_matrix(2,:),[ddq1,ddq2],[0,1])])
%Coriolis Matrix
coriolis_matrix = formula(simplify(tau - gravity_matrix - mass_matrix*[ddq1;ddq2]))
system_input = formula(mass_matrix*[ddq1;ddq2] + coriolis_matrix + gravity_matrix);
%% Part C: Feedback Linearlization

%For diff(theta1,t,2)
%v1 = ddq1;
x11 = q1;
x12 = dq1;
x1 = [x11; x12];
%dx1 = [x12; v1];
A1 = [0 1; 0 0];
B1 = [0; 1];
%A_sys = A - BK
lambda1 = [-3, -4]
K1 = place(A1, B1, lambda1)
v1 = (-K1 * (x1 - x1d_trajectory)) + v1d_trajectory;

% For diff(theta2,t,2)
%v2 = ddq2;
x21 = q2;
x22 = dq2;
x2 = [x21; x22];
%dx2 = [x22; v2];
A2 = [0 1; 0 0];
B2 = [0; 1];
%A_sys = A - BK
lambda2 = [-5, -6]
K2 = place(A2, B2, lambda2)
v2 = (-K2 * (x2 - x2d_trajectory)) + v2d_trajectory;

% Virtual Control Input
v = formula([v1; v2])

% State FeedBack Control Strategy
system_input = subs(system_input, [ddq1, ddq2], [v(1), v(2)])
%% Part D: Update ODE Function from Programming Assignment 2

syms x1(t) x2(t) x3(t) x4(t)
%x = [x1;x2;x3;x4] = [theta1; dtheta1; theta2; dtheta2]
%dx = [dx1;dx2;dx3;dx4] = [dtheta1; ddtheta1; dtheta2; ddtheta2]
%dx = [x2;ddq1;x3;ddq2]
%dx = subs(ddq_mf,[T1,T2],[system_input(1),system_input(2)]);
%[mddq1,mddq2] = solve(dx,[ddq1,ddq2]);
%v_func = [x2; mddq1; x4; mddq2];
v_func = [x2; v(1); x4; v(2)];
v_func = subs(v_func, [q1, dq1, q2, dq2], [x1, x2, x3, x4]);
vars = [x1(t) x2(t) x3(t) x4(t)];
% Modified prog_assignment2.m
%% Part E: Simulate the system using ODE45

initial_params = [deg2rad(200); deg2rad(0); deg2rad(125); deg2rad(0)];
%clear time state_space_matrix system_plot_points theta_plot_points;
prog_assignment2;
t_size = size(time);
t_size = t_size(1, 1);
theta_plot_points = zeros(t_size, 4);
system_input_points = zeros(t_size, 2);

for i = 1:t_size
    theta_plot_points(i, 1) = (simplify(subs(x1d_trajectory(1), t, time(i, 1))));
    theta_plot_points(i, 2) = (simplify(subs(x1d_trajectory(2), t, time(i, 1))));
    theta_plot_points(i, 3) = (simplify(subs(x2d_trajectory(1), t, time(i, 1))));
    theta_plot_points(i, 4) = (simplify(subs(x2d_trajectory(2), t, time(i, 1))));
    system_input_points(i, 1) = double(simplify(subs(system_input(1), [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));
    system_input_points(i, 2) = double(simplify(subs(system_input(2), [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));
    virtual_input(i,1) = double(simplify(subs(v1, [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));
    virtual_input(i,2) = double(simplify(subs(v2, [q1, dq1, q2, dq2, t], [state_space_matrix(i, 1), state_space_matrix(i, 2), state_space_matrix(i, 3), state_space_matrix(i, 4), time(i, 1)])));
end

tau1_max = max(system_input_points(:, 1))
tau1_min = min(system_input_points(:, 1))
tau2_max = max(system_input_points(:, 2))
tau2_min = min(system_input_points(:, 2))
%% Calculating Link Positions

actual_position = zeros(t_size(1, 1), 4);
trajectory_position = zeros(t_size(1, 1), 2);

for i = 1:t_size(1, 1)
    actual_position(i, 1) = arm_1_length * sin(state_space_matrix(i, 1));
    actual_position(i, 2) = arm_1_length * cos(state_space_matrix(i, 1));
    actual_position(i, 3) = actual_position(i, 1) + arm_2_length * sin(state_space_matrix(i, 1) + state_space_matrix(i, 3));
    actual_position(i, 4) = actual_position(i, 2) + arm_2_length * cos(state_space_matrix(i, 1) + state_space_matrix(i, 3));
    trajectory_position(i, 1) = arm_1_length * sin(theta_plot_points(i, 1));
    trajectory_position(i, 2) = arm_1_length * cos(theta_plot_points(i, 1));
    trajectory_position(i, 3) = trajectory_position(i, 1) + arm_2_length * sin(theta_plot_points(i, 1) + theta_plot_points(i, 3));
    trajectory_position(i, 4) = trajectory_position(i, 2) + arm_2_length * cos(theta_plot_points(i, 1) + theta_plot_points(i, 3));
end
%% Animation

xAxisArrayXCoordinates = [-2 2];
xAxisArrayYCoordinates = [0 0];
yAxisArrayXCoordinates = [0 0];
yAxisArrayYCoordinates = [-2 2];
th = 0:pi / 50:2 * pi;
xunit = ((arm_1_length + arm_2_length) * cos(th));
yunit = ((arm_1_length + arm_2_length) * sin(th));
animation = VideoWriter('MATLAB Simulation.avi');
open(animation);
for i = 1:1:t_size(1, 1)
    %Plotting Graph
    actuallink1XCoordinates = [0 actual_position(i, 1)];
    actuallink1YCoordinates = [0 actual_position(i, 2)];
    actuallink2XCoordinates = [actual_position(i, 1) actual_position(i, 3)];
    actuallink2YCoordinates = [actual_position(i, 2) actual_position(i, 4)];
    trajectorylink1XCoordinates = [0 trajectory_position(i, 1)];
    trajectorylink1YCoordinates = [0 trajectory_position(i, 2)];
    trajectorylink2XCoordinates = [trajectory_position(i, 1) trajectory_position(i, 3)];
    trajectorylink2YCoordinates = [trajectory_position(i, 2) trajectory_position(i, 4)];
    plot(xunit, yunit, 'k', 'LineStyle', 'REPLACE_WITH_DASH_DASH'); % Draw Circular Axes
    hold on;
    plot(actuallink1XCoordinates, actuallink1YCoordinates, 'red');
    plot(actuallink2XCoordinates, actuallink2YCoordinates, 'blue');
    plot(trajectorylink1XCoordinates, trajectorylink1YCoordinates, 'black');
    plot(trajectorylink2XCoordinates, trajectorylink2YCoordinates, 'black');
    frame = getframe(gcf);
    writeVideo(animation,frame);
    pause(0.1); % pause to see realtime animation. Given in seconds
    hold off;
end
close(animation);
%% Part E (a): Plot Trajectories

plot(time, theta_plot_points(:, 1), 'black')
hold on;
plot(time, state_space_matrix(:, 1), 'red')
legend('Trajectory', 'Actual Path')
hold off;
grid on;
xlabel('time');
ylabel('\theta_{1}')
title('MATLAB Simulation')
saveas(gcf, 'matlab_theta1.jpg')


plot(time, theta_plot_points(:, 2), 'black')
hold on;
plot(time, state_space_matrix(:, 2), 'red')
legend('Trajectory', 'Actual Path')
hold off;
grid on;
xlabel('time');
ylabel('$\dot{\theta}_{1}$', 'Interpreter', 'latex')
title('MATLAB Simulation')
saveas(gcf, 'matlab_dtheta1.jpg')

plot(time, system_input_points(:, 1), 'black')
hold on;
plot(time, virtual_input(:, 1), 'red')
hold off;
legend('Torque','Virtual Input')
grid on;
xlabel('time');
ylabel('\tau_{1}')
title('MATLAB Simulation')
saveas(gcf, 'matlab_tau1.jpg')

plot(time, theta_plot_points(:, 3), 'black')
hold on;
plot(time, state_space_matrix(:, 3), 'red')
legend('Trajectory', 'Actual Path')
hold off;
grid on;
xlabel('time');
ylabel('\theta_{2}')
title('MATLAB Simulation')
saveas(gcf, 'matlab_theta2.jpg')

plot(time, theta_plot_points(:, 4), 'black')
hold on;
plot(time, state_space_matrix(:, 4), 'red')
legend('Trajectory', 'Actual Path')
hold off;
grid on;
xlabel('time');
ylabel('$\dot{\theta}_{2}$', 'Interpreter', 'latex')
title('MATLAB Simulation')
saveas(gcf, 'matlab_dtheta2.jpg')

plot(time, system_input_points(:, 2), 'black')
hold on;
plot(time, virtual_input(:, 2), 'red')
hold off;
legend('Torque','Virtual Input')
grid on;
xlabel('time');
ylabel('\tau_{2}')
title('MATLAB Simulation')
saveas(gcf, 'matlab_tau2.jpg')
%% Saving Data

delete 'matlab_efforts.xls';
delete 'matlab_theta_plot_points.xls';
delete 'matlab_virtual_input.xls';
delete 'matlab_time.xls';
delete 'trajectory.xls';

writematrix(system_input_points,'matlab_efforts.xls');
writematrix(state_space_matrix,'matlab_theta_plot_points.xls');
writematrix(virtual_input,'matlab_virtual_input.xls');
writematrix(time,'matlab_time.xls');
writematrix(theta_plot_points,'trajectory.xls');
%% Part F: Gazebo Simulation

clc;
clear all;
close all;
rrbot_traj_control% Run the file for next part
%% Comparing Results

clc;
clear all;
close all;
matlab_efforts = readmatrix('matlab_efforts.xls');
matlab_joint_states = readmatrix('matlab_theta_plot_points.xls');
matlab_virtual_input = readmatrix('matlab_virtual_input.xls');
matlab_time = readmatrix('matlab_time.xls');
trajectory = readmatrix('trajectory.xls');
gazebo_efforts = readmatrix('gazebo_efforts.xls');
gazebo_joint_states = readmatrix('gazebo_theta_plot_points.xls');
gazebo_virtual_input = readmatrix('gazebo_virtual_input.xls');
gazebo_time = readmatrix('gazebo_time.xls');

plot(matlab_time, trajectory(:, 1), 'black')
hold on;
plot(matlab_time, matlab_joint_states(:, 1), 'red')
hold on;
plot(gazebo_time, gazebo_joint_states(:, 1), 'green')
legend('Trajectory','Matlab', 'Gazebo')
hold off;
grid on;
xlabel('time');
ylabel('\theta_{1}')
saveas(gcf, 'comparision_theta1.jpg')

plot(matlab_time, trajectory(:, 2), 'black')
hold on;
plot(matlab_time, matlab_joint_states(:, 2), 'red')
hold on;
plot(gazebo_time, gazebo_joint_states(:, 2), 'green')
legend('Trajectory', 'Matlab', 'Gazebo')
hold off;
grid on;
xlabel('time');
ylabel('$\dot{\theta}_{1}$', 'Interpreter', 'latex')
saveas(gcf, 'comparision_dtheta1.jpg')

plot(matlab_time, matlab_efforts(:, 1), 'red')
hold on;
plot(matlab_time, matlab_virtual_input(:, 1), 'green')
plot(gazebo_time, gazebo_efforts(:, 1), 'blue')
plot(gazebo_time, gazebo_virtual_input(:, 1), 'black')
hold off;
legend('MATLAB Torque', 'MATLAB Virtual Input', 'Gazebo Torque', 'Gazebo Virtual Input')
grid on;
xlabel('time');
ylabel('\tau_{1}')
saveas(gcf, 'comparision_tau1.jpg')

plot(matlab_time, trajectory(:, 3), 'black')
hold on;
plot(matlab_time, matlab_joint_states(:, 3), 'red')
hold on;
plot(gazebo_time, gazebo_joint_states(:, 3), 'green')
legend('Trajectory', 'Matlab', 'Gazebo')
hold off;
grid on;
xlabel('time');
ylabel('\theta_{2}')
saveas(gcf, 'comparision_theta2.jpg')

plot(matlab_time, trajectory(:, 4), 'black')
hold on;
plot(matlab_time, matlab_joint_states(:, 4), 'red')
hold on;
plot(gazebo_time, gazebo_joint_states(:, 4), 'green')
legend('Trajectory', 'Matlab', 'Gazebo')
hold off;
grid on;
xlabel('time');
ylabel('$\dot{\theta}_{2}$', 'Interpreter', 'latex')
saveas(gcf, 'comparision_dtheta2.jpg')

plot(matlab_time, matlab_efforts(:, 1), 'red')
hold on;
plot(matlab_time, matlab_virtual_input(:, 1), 'green')
plot(gazebo_time, gazebo_efforts(:, 1), 'blue')
plot(gazebo_time, gazebo_virtual_input(:, 1), 'black')
hold off;
legend('MATLAB Torque', 'MATLAB Virtual Input', 'Gazebo Torque', 'Gazebo Virtual Input')
grid on;
xlabel('time');
ylabel('\tau_{1}')
saveas(gcf, 'comparision_tau1.jpg')
##### SOURCE END #####
-->
</div></body></html>